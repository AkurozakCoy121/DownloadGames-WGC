<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPGM - Universal Platform Game Market</title>
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap">
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, getDoc, addDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
        
        // Ensure global variables exist
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth, db;
        let currentUser = null;
        let gamesData = [];
        let filteredGames = [];
        let currentView = 'home';
        let selectedGame = null;
        
        // DOM Elements
        const appContainer = document.getElementById('app');
        const headerContainer = document.getElementById('header-container');
        const footerContainer = document.getElementById('footer-container');
        const modalContainer = document.getElementById('modal-container');

        // Firebase Initialization and Auth Functions
        const initFirebase = async () => {
            if (!firebaseConfig) {
                console.error("Firebase config is not available. Please check the configuration.");
                return;
            }
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Authentication state listener
                onAuthStateChanged(auth, (user) => {
                    currentUser = user;
                    updateHeader();
                    renderContent();
                });

                // Try to sign in with a custom token, if it fails, sign in anonymously
                if (initialAuthToken) {
                    try {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Successfully signed in with custom token.");
                    } catch (error) {
                        console.error("Failed to sign in with custom token:", error);
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously as a fallback.");
                    }
                } else {
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }

                // Fetch real-time game data
                const gamesRef = collection(db, `artifacts/${appId}/public/data/games`);
                onSnapshot(gamesRef, (snapshot) => {
                    gamesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    // Filter for approved games
                    filteredGames = gamesData.filter(game => game.status === 'approved');
                    filteredGames.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    renderContent();
                }, (error) => {
                    showModal('Error', `Failed to load game data: ${error.message}`);
                    console.error("Error fetching games:", error);
                });

            } catch (error) {
                showModal('Error', `Failed to initialize Firebase: ${error.message}`);
                console.error("Firebase initialization failed:", error);
            }
        };

        // Modal Function
        const showModal = (title, message) => {
            modalContainer.innerHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm">
                        <h2 class="text-xl font-bold text-white mb-2">${title}</h2>
                        <p class="text-gray-300 mb-4">${message}</p>
                        <div class="text-right">
                            <button onclick="closeModal()" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-md transition-colors">Close</button>
                        </div>
                    </div>
                </div>
            `;
        };

        const closeModal = () => {
            modalContainer.innerHTML = '';
        };
        window.closeModal = closeModal;

        // Header Render Function
        const updateHeader = () => {
            let authButtons = `
                <button onclick="setView('login')" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-full transition-colors">Login / Signup</button>
            `;
            if (currentUser && currentUser.isAnonymous === false) {
                authButtons = `
                    <button onclick="setView('upload')" class="nav-link">Upload</button>
                    <button onclick="setView('dashboard')" class="nav-link">Dashboard</button>
                    <button onclick="handleLogout()" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-full transition-colors">Logout</button>
                `;
            }

            headerContainer.innerHTML = `
                <div class="container mx-auto flex justify-between items-center flex-wrap">
                    <div class="flex items-center space-x-2">
                        <span class="text-orange-500 text-3xl font-extrabold">UPGM</span>
                        <span class="hidden md:inline-block text-white text-xl">Universal Platform Game Market</span>
                    </div>
                    <nav class="flex items-center space-x-4 mt-4 md:mt-0">
                        <button onclick="setView('home')" class="nav-link">Home</button>
                        <button onclick="setView('browse')" class="nav-link">Browse</button>
                        <button onclick="setView('community')" class="nav-link">Community</button>
                        ${authButtons}
                    </nav>
                </div>
            `;
        };

        // Footer Render Function
        const renderFooter = () => {
            footerContainer.innerHTML = `
                <div class="container mx-auto text-center text-gray-400">
                    <p>Â© 2025 UPGM. All Rights Reserved.</p>
                    <div class="flex justify-center space-x-4 mt-2">
                        <a href="#" class="hover:text-white transition-colors">Terms & Conditions</a>
                        <a href="#" class="hover:text-white transition-colors">Privacy Policy</a>
                        <a href="#" class="hover:text-white transition-colors">Contact</a>
                    </div>
                </div>
            `;
        };

        // View switching function
        const setView = (view, gameId = null) => {
            currentView = view;
            if (gameId) {
                selectedGame = filteredGames.find(g => g.id === gameId);
                // Simple view counter for analytics
                if (selectedGame) {
                    const gameRef = doc(db, `artifacts/${appId}/public/data/games`, selectedGame.id);
                    updateDoc(gameRef, {
                        views: (selectedGame.views || 0) + 1
                    }).catch(e => console.error("Error updating view count:", e));
                }
            }
            renderContent();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        window.setView = setView;

        // Login handler
        const handleLogin = async (e) => {
            e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showModal('Success', 'You have successfully logged in!');
                setView('dashboard');
            } catch (error) {
                showModal('Error', `Login failed: ${error.message}`);
            }
        };
        window.handleLogin = handleLogin;

        // Signup handler
        const handleSignup = async (e) => {
            e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showModal('Success', 'Account created successfully! Please log in.');
                setView('login');
            } catch (error) {
                showModal('Error', `Signup failed: ${error.message}`);
            }
        };
        window.handleSignup = handleSignup;

        // Logout handler
        const handleLogout = async () => {
            await signOut(auth);
            showModal('Success', 'You have been logged out.');
            setView('home');
        };
        window.handleLogout = handleLogout;

        // Game Upload handler
        const handleUploadGame = async (e) => {
            e.preventDefault();
            if (!currentUser || currentUser.isAnonymous) {
                showModal('Error', 'You must be logged in to upload a game.');
                return;
            }

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            // Basic client-side validation
            if (!data.title || !data.description || !data.coverUrl || !data.fileUrl) {
                showModal('Error', 'Title, description, Cover URL, and Game File URL are required.');
                return;
            }
            
            // Check if fileUrl is valid
            try {
                new URL(data.fileUrl);
            } catch (e) {
                showModal('Error', 'Invalid Game File URL. Please provide a valid URL.');
                return;
            }

            const gameData = {
                title: data.title,
                description: data.description,
                genre: data.genre,
                price: parseFloat(data.price) || 0,
                coverUrl: data.coverUrl,
                screenshots: data.screenshots.split(',').map(s => s.trim()).filter(s => s),
                videoUrl: data.videoUrl,
                fileUrl: data.fileUrl,
                version: data.version,
                platform: data.platform.split(',').map(p => p.trim()).filter(p => p),
                size: data.size,
                tags: data.tags.split(',').map(t => t.trim()).filter(t => t),
                developerId: currentUser.uid,
                isVerified: false, // Default to false, can be set to true by admin
                status: 'pending', // Requires admin approval
                views: 0,
                downloads: 0,
                createdAt: new Date().toISOString(),
                rating: 0,
            };

            try {
                const gamesRef = collection(db, `artifacts/${appId}/public/data/games`);
                await addDoc(gamesRef, gameData);
                showModal('Success', 'Your game has been uploaded and is pending admin approval!');
                e.target.reset();
                setView('dashboard');
            } catch (error) {
                showModal('Error', `Failed to upload game: ${error.message}`);
            }
        };
        window.handleUploadGame = handleUploadGame;

        // Handles download button click and increments download counter
        const handleDownload = (gameId, fileUrl) => {
            const gameRef = doc(db, `artifacts/${appId}/public/data/games`, gameId);
            const game = gamesData.find(g => g.id === gameId);
            if (game) {
                updateDoc(gameRef, {
                    downloads: (game.downloads || 0) + 1
                }).catch(e => console.error("Error updating download count:", e));
            }
            window.open(fileUrl, '_blank');
        };
        window.handleDownload = handleDownload;

        // Filter and Search Logic
        const filterGames = () => {
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const genreFilter = document.getElementById('genre-filter').value;
            const priceFilter = document.getElementById('price-filter').value;

            const filtered = gamesData.filter(game => {
                const matchesSearch = game.title.toLowerCase().includes(searchInput) || game.description.toLowerCase().includes(searchInput);
                const matchesGenre = genreFilter === 'All' || game.genre === genreFilter;
                const matchesPrice = priceFilter === 'All' || 
                                     (priceFilter === 'Free' && game.price === 0) ||
                                     (priceFilter === 'Paid' && game.price > 0);
                return game.status === 'approved' && matchesSearch && matchesGenre && matchesPrice;
            });

            filteredGames = filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            renderContent();
        };
        window.filterGames = filterGames;

        // Main Render Function
        const renderContent = () => {
            let content = '';
            let title = 'Loading...';

            switch(currentView) {
                case 'home':
                    title = 'UPGM - Universal Platform Game Market';
                    const featuredGames = filteredGames.slice(0, 4);
                    const gameCards = featuredGames.map(game => `
                        <div onclick="setView('gameDetail', '${game.id}')" class="bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transition-transform transform hover:scale-105">
                            <img src="${game.coverUrl}" alt="${game.title}" class="w-full h-48 object-cover object-center" onerror="this.onerror=null;this.src='https://placehold.co/400x250/2d3748/ffffff?text=Image+Not+Found';">
                            <div class="p-4">
                                <h3 class="text-white text-lg font-bold truncate">${game.title}</h3>
                                <p class="text-gray-400 text-sm">${game.genre}</p>
                                <div class="mt-2 flex justify-between items-center">
                                    <span class="text-orange-400 font-semibold">${game.price === 0 ? 'Free' : `Rp${game.price.toLocaleString('id-ID')}`}</span>
                                    <span class="text-gray-400 text-sm">Rating: ${game.rating > 0 ? game.rating : 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    content = `
                        <div class="p-4 md:p-8">
                            <div class="relative bg-cover bg-center h-64 md:h-96 rounded-lg shadow-lg" style="background-image: url('https://placehold.co/1200x400/1E2A38/FF6B35?text=UPGM+-+Universal+Platform+Game+Market');">
                                <div class="absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center p-4">
                                    <div class="text-center">
                                        <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-4">Discover & Upload Great Indie Games</h1>
                                        <p class="text-xl md:text-2xl text-white font-light">All the games you love, in one place.</p>
                                    </div>
                                </div>
                            </div>
                            <h2 class="text-white text-3xl font-bold mt-12 mb-6">Featured Games</h2>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                ${gameCards}
                            </div>
                        </div>
                    `;
                    break;
                case 'browse':
                    title = 'Browse Games';
                    const genres = [...new Set(gamesData.map(g => g.genre))];
                    const genreOptions = genres.map(g => `<option value="${g}">${g}</option>`).join('');

                    const allGameCards = filteredGames.map(game => `
                        <div onclick="setView('gameDetail', '${game.id}')" class="bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transition-transform transform hover:scale-105">
                            <img src="${game.coverUrl}" alt="${game.title}" class="w-full h-48 object-cover object-center" onerror="this.onerror=null;this.src='https://placehold.co/400x250/2d3748/ffffff?text=Image+Not+Found';">
                            <div class="p-4">
                                <h3 class="text-white text-lg font-bold truncate">${game.title}</h3>
                                <p class="text-gray-400 text-sm">${game.genre}</p>
                                <div class="mt-2 flex justify-between items-center">
                                    <span class="text-orange-400 font-semibold">${game.price === 0 ? 'Free' : `Rp${game.price.toLocaleString('id-ID')}`}</span>
                                    <span class="text-gray-400 text-sm">Rating: ${game.rating > 0 ? game.rating : 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    content = `
                        <div class="p-4 md:p-8">
                            <h2 class="text-white text-3xl font-bold mb-6">Browse Games</h2>
                            <div class="flex flex-wrap gap-4 mb-6">
                                <input type="text" id="search-input" oninput="filterGames()" placeholder="Search by title or description..." class="flex-grow max-w-sm px-4 py-2 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                <select id="genre-filter" onchange="filterGames()" class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    <option value="All">All Genres</option>
                                    ${genreOptions}
                                </select>
                                <select id="price-filter" onchange="filterGames()" class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    <option value="All">All Prices</option>
                                    <option value="Free">Free</option>
                                    <option value="Paid">Paid</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                ${allGameCards.length > 0 ? allGameCards : '<p class="text-gray-400">No games found with that criteria.</p>'}
                            </div>
                        </div>
                    `;
                    break;
                case 'gameDetail':
                    if (!selectedGame) {
                        setView('browse');
                        return;
                    }
                    title = selectedGame.title;
                    const screenshotHtml = selectedGame.screenshots && selectedGame.screenshots.length > 0
                        ? selectedGame.screenshots.map((url, index) => `
                            <img src="${url}" alt="Screenshot ${index + 1}" class="w-64 h-auto rounded-lg flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/400x250/2d3748/ffffff?text=Image+Not+Found';">
                        `).join('')
                        : '';
                    
                    const isHtml5Game = selectedGame.fileUrl.endsWith('.html') || selectedGame.fileUrl.endsWith('.htm');
                    const playButton = isHtml5Game ? `
                        <button onclick="document.getElementById('web-demo-iframe').classList.remove('hidden')" class="mt-6 w-full inline-block text-center px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-full transition-colors">Play Now</button>
                    ` : '';
                    
                    const developerBadge = selectedGame.isVerified ? `
                        <span class="ml-2 text-blue-500" title="Verified Developer">â</span>
                    ` : '';

                    content = `
                        <div class="p-4 md:p-8" style="background-image: url('${selectedGame.customBgUrl || ''}'); background-size: cover; background-position: center; background-repeat: no-repeat;">
                            <button onclick="setView('browse')" class="text-gray-400 hover:text-orange-500 transition-colors mb-4">&larr; Back to List</button>
                            <div class="bg-gray-800 bg-opacity-90 backdrop-blur rounded-lg shadow-lg overflow-hidden p-6">
                                <div class="md:flex">
                                    <div class="md:w-1/3">
                                        <img src="${selectedGame.coverUrl}" alt="${selectedGame.title}" class="w-full h-auto rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/400x250/2d3748/ffffff?text=Image+Not+Found';">
                                        <div class="mt-6">
                                            <h3 class="text-white font-bold text-xl mb-2">Game Info</h3>
                                            <ul class="text-gray-400 space-y-2">
                                                <li><strong>Genre:</strong> ${selectedGame.genre}</li>
                                                <li><strong>Platform:</strong> ${selectedGame.platform.join(', ')}</li>
                                                <li><strong>Version:</strong> ${selectedGame.version}</li>
                                                <li><strong>Size:</strong> ${selectedGame.size}</li>
                                                <li><strong>Price:</strong> ${selectedGame.price === 0 ? 'Free' : `Rp${selectedGame.price.toLocaleString('id-ID')}`}</li>
                                                <li><strong>Rating:</strong> ${selectedGame.rating > 0 ? selectedGame.rating : 'N/A'}</li>
                                            </ul>
                                            ${playButton}
                                            <button onclick="handleDownload('${selectedGame.id}', '${selectedGame.fileUrl}')" class="mt-2 w-full inline-block text-center px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-full transition-colors">Download / Buy</button>
                                        </div>
                                    </div>
                                    <div class="md:w-2/3 md:pl-8 mt-6 md:mt-0">
                                        <h1 class="text-white text-4xl font-bold mb-2">${selectedGame.title}</h1>
                                        <p class="text-gray-400 text-sm mb-4">By <span class="text-orange-400 font-semibold">Developer ${selectedGame.developerId.substring(0, 8)}...</span>${developerBadge}</p>
                                        <p class="text-gray-300 mb-6">${selectedGame.description}</p>
                                        ${selectedGame.videoUrl ? `
                                            <div class="aspect-w-16 aspect-h-9 w-full mb-6">
                                                <iframe class="rounded-lg w-full h-full" src="${selectedGame.videoUrl.replace('watch?v=', 'embed/')}" title="Game Trailer" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                            </div>` : ''}
                                        <div class="flex space-x-4 overflow-x-auto py-2">
                                            ${screenshotHtml}
                                        </div>
                                    </div>
                                </div>
                                ${isHtml5Game ? `
                                <div id="web-demo-container" class="mt-8 rounded-lg overflow-hidden bg-gray-900">
                                    <h3 class="text-white text-2xl font-bold mb-4 p-4 border-b border-gray-700">Web Demo</h3>
                                    <div class="relative w-full aspect-w-16 aspect-h-9 hidden" id="web-demo-iframe">
                                        <iframe src="${selectedGame.fileUrl}" class="absolute inset-0 w-full h-full" frameborder="0" allowfullscreen></iframe>
                                    </div>
                                </div>` : ''}
                            </div>
                            <div class="mt-8 bg-gray-800 rounded-lg p-6">
                                <h3 class="text-white font-bold text-2xl mb-4">Comments</h3>
                                <p class="text-gray-400">Comments and ratings are not yet implemented. This would be saved in Firestore and linked to user profiles.</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'upload':
                    title = 'Upload New Game';
                    if (!currentUser || currentUser.isAnonymous) {
                        content = `<div class="p-8"><p class="text-gray-400">You must be logged in to upload a game.</p></div>`;
                    } else {
                        content = `
                            <div class="p-4 md:p-8 max-w-2xl mx-auto">
                                <h2 class="text-white text-3xl font-bold mb-6">Upload New Game</h2>
                                <form onsubmit="handleUploadGame(event)" class="bg-gray-800 p-6 rounded-lg shadow-lg space-y-4">
                                    <p class="text-gray-400 mb-4 text-sm italic">Note: All game files and assets must be provided as external URLs. New games require admin approval and will be marked as 'Pending'.</p>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Game Title</label>
                                        <input type="text" name="title" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Game Description</label>
                                        <textarea name="description" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 h-32 focus:outline-none focus:ring-2 focus:ring-orange-500"></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Genre</label>
                                        <select name="genre" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                                            <option value="Action">Action</option>
                                            <option value="RPG">RPG</option>
                                            <option value="Horror">Horror</option>
                                            <option value="Simulation">Simulation</option>
                                            <option value="Casual">Casual</option>
                                            <option value="Puzzle">Puzzle</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Price (in IDR, 0 for free)</label>
                                        <input type="number" name="price" value="0" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Cover URL</label>
                                        <input type="url" name="coverUrl" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Screenshot URLs (comma-separated)</label>
                                        <input type="text" name="screenshots" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Trailer URL (YouTube Embed)</label>
                                        <input type="url" name="videoUrl" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Game File URL (Download/Buy)</label>
                                        <input type="url" name="fileUrl" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Game Version (e.g., v1.0, Beta)</label>
                                        <input type="text" name="version" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Platforms (e.g., Windows, Mac, Linux, comma-separated)</label>
                                        <input type="text" name="platform" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">File Size (e.g., 1.2 GB)</label>
                                        <input type="text" name="size" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">Tags (max 5, comma-separated)</label>
                                        <input type="text" name="tags" class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                    </div>
                                    <button type="submit" class="w-full px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-full transition-colors">Upload Game</button>
                                </form>
                            </div>
                        `;
                    }
                    break;
                case 'dashboard':
                    title = 'My Dashboard';
                    if (!currentUser || currentUser.isAnonymous) {
                        content = `<div class="p-8"><p class="text-gray-400">Please log in to view your dashboard.</p></div>`;
                    } else {
                        const userGames = gamesData.filter(g => g.developerId === currentUser.uid);
                        const dashboardGameCards = userGames.map(game => `
                            <div onclick="setView('gameDetail', '${game.id}')" class="bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transition-transform transform hover:scale-105">
                                <img src="${game.coverUrl}" alt="${game.title}" class="w-full h-48 object-cover object-center" onerror="this.onerror=null;this.src='https://placehold.co/400x250/2d3748/ffffff?text=Image+Not+Found';">
                                <div class="p-4">
                                    <h3 class="text-white text-lg font-bold truncate">${game.title}</h3>
                                    <p class="text-gray-400 text-sm">Status: <span class="${game.status === 'approved' ? 'text-green-400' : 'text-yellow-400'}">${game.status}</span></p>
                                </div>
                            </div>
                        `).join('');
                        content = `
                            <div class="p-4 md:p-8">
                                <h2 class="text-white text-3xl font-bold mb-6">My Dashboard</h2>
                                <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
                                    <p class="text-gray-300 mb-2"><strong>User ID:</strong> ${currentUser.uid}</p>
                                    <p class="text-gray-300 mb-4"><strong>Status:</strong> ${userGames.some(g => g.isVerified) ? 'Verified Developer' : 'Standard Developer'}</p>
                                    <h3 class="text-xl font-bold text-white mb-4">Analytics (Coming Soon)</h3>
                                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
                                        <div class="bg-gray-700 p-4 rounded-lg">
                                            <p class="text-3xl font-bold text-orange-400">${userGames.reduce((sum, g) => sum + (g.views || 0), 0)}</p>
                                            <p class="text-sm text-gray-400">Total Views</p>
                                        </div>
                                        <div class="bg-gray-700 p-4 rounded-lg">
                                            <p class="text-3xl font-bold text-orange-400">${userGames.reduce((sum, g) => sum + (g.downloads || 0), 0)}</p>
                                            <p class="text-sm text-gray-400">Total Downloads</p>
                                        </div>
                                        <div class="bg-gray-700 p-4 rounded-lg">
                                            <p class="text-3xl font-bold text-orange-400">N/A</p>
                                            <p class="text-sm text-gray-400">Average Rating</p>
                                        </div>
                                        <div class="bg-gray-700 p-4 rounded-lg">
                                            <p class="text-3xl font-bold text-orange-400">${userGames.length}</p>
                                            <p class="text-sm text-gray-400">Total Games</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                                    <h3 class="text-xl font-bold text-white mb-4">My Uploaded Games</h3>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                        ${dashboardGameCards.length > 0 ? dashboardGameCards : '<p class="text-gray-400">You have not uploaded any games.</p>'}
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    break;
                case 'login':
                    title = 'Login to UPGM';
                    content = `
                        <div class="p-4 md:p-8 flex items-center justify-center min-h-[calc(100vh-128px)]">
                            <form onsubmit="handleLogin(event)" class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-sm space-y-4">
                                <h2 class="text-white text-2xl font-bold text-center">Login</h2>
                                <div>
                                    <label class="block text-gray-300 mb-1">Email</label>
                                    <input type="email" name="email" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-1">Password</label>
                                    <input type="password" name="password" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                </div>
                                <button type="submit" class="w-full px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-full transition-colors">Login</button>
                                <p class="text-center text-gray-400">Don't have an account? <a href="#" onclick="setView('signup')" class="text-orange-500 hover:underline">Sign up here</a></p>
                            </form>
                        </div>
                    `;
                    break;
                case 'signup':
                    title = 'Create a New Account';
                    content = `
                        <div class="p-4 md:p-8 flex items-center justify-center min-h-[calc(100vh-128px)]">
                            <form onsubmit="handleSignup(event)" class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-sm space-y-4">
                                <h2 class="text-white text-2xl font-bold text-center">Sign Up</h2>
                                <div>
                                    <label class="block text-gray-300 mb-1">Email</label>
                                    <input type="email" name="email" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-1">Password</label>
                                    <input type="password" name="password" required class="w-full px-3 py-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500" />
                                </div>
                                <button type="submit" class="w-full px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-full transition-colors">Sign Up</button>
                                <p class="text-center text-gray-400">Already have an account? <a href="#" onclick="setView('login')" class="text-orange-500 hover:underline">Login here</a></p>
                            </form>
                        </div>
                    `;
                    break;
                case 'community':
                    title = 'Community Forum';
                    content = `
                        <div class="p-4 md:p-8">
                            <h2 class="text-white text-3xl font-bold mb-6">Community Forum</h2>
                            <p class="text-gray-400">The community forum feature is not yet implemented. This would include text and image posts from URLs, and a discussion system among users.</p>
                        </div>
                    `;
                    break;
            }
            appContainer.innerHTML = content;
        };

        // Initialize app on document load
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            updateHeader();
            renderFooter();
            renderContent();
        });
    </script>
    <style>
        body {
            background-color: #1e2a38;
            font-family: 'Inter', sans-serif;
            color: #d1d5db;
        }
        .nav-link {
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
            position: relative;
        }
        .nav-link:hover {
            color: #ffffff;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f97316;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 80%;
        }
        .aspect-w-16 {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
        }
        .aspect-h-9 {
            padding-top: 56.25%;
        }
        .aspect-w-16 > * {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-[#1e2a38]">
    <!-- Header -->
    <header id="header-container" class="bg-gray-800 p-4 shadow-md sticky top-0 z-40">
        <!-- Content will be rendered by JS -->
    </header>

    <!-- Main Content -->
    <main id="app" class="container mx-auto p-4 md:p-8 min-h-[calc(100vh-128px)]">
        <!-- Content will be rendered by JS -->
        <div class="flex flex-col items-center justify-center min-h-[calc(100vh-128px)]">
            <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-orange-500"></div>
            <p class="mt-4 text-xl text-white">Loading...</p>
        </div>
    </main>

    <!-- Footer -->
    <footer id="footer-container" class="bg-gray-800 py-6 mt-8">
        <!-- Content will be rendered by JS -->
    </footer>
    
    <!-- Custom Modal Container -->
    <div id="modal-container"></div>
</body>
</html>
